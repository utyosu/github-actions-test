name: CI

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest

    services:
      mysql:
        image: mysql:5.7
        options: --health-cmd "mysqladmin ping -h localhost" --health-interval 20s --health-timeout 10s --health-retries 10
        env:
          MYSQL_ROOT_PASSWORD: "hogehoge"

    steps:
    - uses: actions/checkout@master
    - uses: actions/setup-ruby@master
      with:
        ruby-version: 2.6.5

    - name: install libraries
      run: |
        yum install mysql-devel

    - name: test
      run: |
        gem install bundler
        bundle config set without development
        bundle install --jobs 4
        bundle exec rspec

    # - name: install libraries
    #   run: sudo apt install -y libmysqlclient-dev

    # - name: install libsodium
    #   run: |
    #     wget https://download.libsodium.org/libsodium/releases/LATEST.tar.gz -O /tmp/LATEST.tar.gz
    #     tar zxvf /tmp/LATEST.tar.gz -C /tmp
    #     cd /tmp/libsodium-stable
    #     ./configure
    #     make
    #     sudo make install

    # - name: Set up Ruby
    #   uses: actions/setup-ruby@v1

    # - name: check ruby version
    #   run: ruby --version

    # - name: bundle install
    #   run: |
    #     gem install bundler
    #     bundle install --jobs 4

    # - name: setup database
    #   run: |
    #     bundle exec rails db:create
    #     bundle exec ridgepole -c config/database.yml --apply -f db/schema -E test

    # - name: exec rspec
    #   run: |
    #     bundle exec rspec
